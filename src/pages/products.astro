---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { products } from '../data/products.js';

const brandDescriptions = {
  'JK Products': "India's leading cement manufacturer with superior quality and strength",
  'JSW Products': "Advanced cement technology for superior durability and sustainability", 
  'UltraTech Products': "India's largest cement company with consistent quality and nationwide trust",
  'Ramco Products': "Premium cement with exceptional weather resistance, perfect for coastal construction",
  'Chemical': "Premium quality chemicals and additives for construction requirements",
  'Building Materials': "High-quality building materials including blocks, bricks, sand and aggregates"
};

const productsByBrand = products.reduce((acc, product) => {
  const brandName = product.brand;
  if (!acc[brandName]) {
    acc[brandName] = {
      products: [],
      // Fix: Use the correct category field and handle the typo in data
      category: product.category || product.categories || 'building-materials',
      description: brandDescriptions[brandName] || ''
    };
  }
  acc[brandName].products.push(product);
  return acc;
}, {});

const productDataForClient = products.reduce((acc, product) => {
  acc[product.id] = product;
  return acc;
}, {});

const brandNamesForClient = Object.keys(productsByBrand);
---

<Layout 
  title="Goa Traders - Cement Supplier & Building Materials Dealer in Goa" 
  description="Leading cement supplier in Goa offering JK, JSW, Ultratech & Ramco cement. Quality building materials, sand, and construction supplies with fast delivery across Goa."
  keywords="cement supplier goa, jk cement dealer goa, jsw cement, ultratech cement, ramco cement, building materials goa, sand supplier goa, construction materials goa, cement dealer panjim, cement dealer margao"
>
  <Header />
  <main>
    <section class="products-hero">
      <div class="container">
        <div class="hero-content">
          <h1>Our Products</h1>
          <p>Complete range of premium cement and building materials for all your construction needs</p>
          <div class="hero-stats">
            <div class="stat">
              <span class="stat-number">4</span>
              <span class="stat-label">Premium Brands</span>
            </div>
            <div class="stat">
              <span class="stat-number">15+</span>
              <span class="stat-label">Product Variants</span>
            </div>
            <div class="stat">
              <span class="stat-number">100%</span>
              <span class="stat-label">Authentic Products</span>
            </div>
          </div>
        </div>
      </div>
    </section>
    
    <section class="product-filter">
      <div class="container">
        <div class="filter-tabs">
          <button class="filter-btn active" data-filter="all">All Products</button>
          <button class="filter-btn" data-filter="cement">Cement</button>
          <button class="filter-btn" data-filter="chemical">Chemicals</button>
          <button class="filter-btn" data-filter="building-materials">Building Materials</button>
        </div>
      </div>
    </section>
    
    <section class="products-section">
      <div class="container">
        {Object.entries(productsByBrand).map(([brandName, brandData]) => {
          const brandId = brandName.toLowerCase().replace(/ & /g, '-').replace(/ /g, '-');
          return (
            <div class="product-category" id={brandId} data-category={brandData.category}>
              <h2 class="category-title">{brandName}</h2>
              <p class="category-description">{brandData.description}</p>
              <div class="carousel-container">
                <div class="products-carousel" id={`${brandId}-carousel`}>
                  {brandData.products.map(product => (
                    <div class="product-card">
                      {product.badge && <div class={`product-badge ${product.badge.class}`}>{product.badge.text}</div>}
                      <div class="product-image">
                        <img src={product.image} alt={product.alt} loading="lazy" />
                        <div class="product-overlay">
                          <button class="quick-view-btn" data-product={product.id}>Quick View</button>
                        </div>
                      </div>
                      <div class="product-info">
                        <h3>{product.name}</h3>
                        <p class="product-description">{product.description}</p>
                        <div class="product-specs">
                          {Object.entries(product.specs).slice(0, 3).map(([key, value]) => (
                            <div class="spec">
                              <span class="spec-label">{key}:</span>
                              <span class="spec-value">{value}</span>
                            </div>
                          ))}
                        </div>
                        <div class="product-features">
                          {product.features.map(feature => (
                            <span class="feature">{feature}</span>
                          ))}
                        </div>
                        <div class="product-actions">
                          <div class="product-price">Contact for Best Price</div>
                          <div class="action-buttons">
                            <a href="/contact" class="btn btn-primary">Get Quote</a>
                            <a href={`https://wa.me/919765664489?text=I'm interested in ${product.name}`} class="btn btn-success btn-sm">
                              <svg viewBox="0 0 24 24" width="16" height="16">
                                  <path fill="currentColor" d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.106"></path>
                              </svg>
                              WhatsApp
                            </a>
                          </div>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
                <button class="carousel-control prev" id={`${brandId}-prev`} aria-label="Previous slide">
                  <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M15.41,16.58L10.83,12L15.41,7.41L14,6L8,12L14,18L15.41,16.58Z"></path></svg>
                </button>
                <button class="carousel-control next" id={`${brandId}-next`} aria-label="Next slide">
                  <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z"></path></svg>
                </button>
                <div class="carousel-dots-container">
                    <div class="carousel-dots" id={`${brandId}-dots`}></div>
                </div>
              </div>
            </div>
          )
        })}
      </div>
    </section>
    <div class="modal-overlay" id="modal-overlay">
      <div class="modal">
        <button class="modal-close" id="modal-close">
          <svg viewBox="0 0 24 24" width="24" height="24"><path fill="currentColor" d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"></path></svg>
        </button>
        <div class="modal-content" id="modal-content"></div>
      </div>
    </div>
    <section class="cta-section">
      <div class="container">
        <div class="cta-content">
          <h2>Need Help Choosing the Right Products?</h2>
          <p>Our experts are here to help you select the best materials for your construction project based on your specific requirements</p>
          <div class="cta-buttons">
            <a href="/contact" class="btn btn-primary">
              <svg viewBox="0 0 24 24" width="22" height="22"><path fill="currentColor" d="M20,15.5C18.8,15.5 17.5,15.3 16.4,14.9C16.3,14.9 16.2,14.9 16.1,14.9C15.8,14.9 15.6,15 15.4,15.2L13.2,17.4C10.4,15.9 8,13.6 6.6,10.8L8.8,8.6C9.1,8.3 9.2,7.9 9,7.6C8.7,6.5 8.5,5.2 8.5,4C8.5,3.5 8,3 7.5,3H4C3.5,3 3,3.5 3,4C3,13.4 10.6,21 20,21C20.5,21 21,20.5 21,20V16.5C21,16 20.5,15.5 20,15.5M5,5H6.5C6.6,5.9 6.8,6.8 7,7.6L5.8,8.8C5.4,7.6 5.1,6.3 5,5M19,19C17.7,18.9 16.4,18.6 15.2,18.2L16.4,17C17.2,17.2 18.1,17.4 19,17.4V19Z"></path></svg>
              Get Expert Advice
            </a>
            <a href="tel:+919765664489" class="btn btn-secondary">
              <svg viewBox="0 0 24 24" width="22" height="22"><path fill="currentColor" d="M6.62,10.79C8.06,13.62 10.38,15.94 13.21,17.38L15.41,15.18C15.69,14.9 16.08,14.82 16.43,14.93C17.55,15.3 18.75,15.5 20,15.5A1,1 0 0,1 21,16.5V20A1,1 0 0,1 20,21A17,17 0 0,1 3,4A1,1 0 0,1 4,3H7.5A1,1 0 0,1 8.5,4C8.5,5.25 8.7,6.45 9.07,7.57C9.18,7.92 9.1,8.31 8.82,8.59L6.62,10.79Z"></path></svg>
              Call Now
            </a>
            <a href="https://wa.me/919765664489" class="btn btn-success">
              <svg viewBox="0 0 24 24" width="22" height="22"><path fill="currentColor" d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.106"></path></svg>
              WhatsApp
            </a>
          </div>
        </div>
      </div>
    </section>
  </main>
  <Footer />
</Layout>

<style>
  /* --- The only change is in the .product-image and .product-image img sections below --- */

  .products-hero{background:linear-gradient(135deg,#1E40AF 0%,#3B82F6 100%);color:white;padding:6rem 0 4rem;text-align:center}.hero-content h1{font-size:3rem;font-weight:700;margin-bottom:1rem;text-shadow:0 2px 4px rgba(0,0,0,0.3)}.hero-content p{font-size:1.25rem;opacity:0.95;max-width:600px;margin:0 auto}.hero-stats{display:flex;justify-content:center;gap:3rem;margin-top:2rem}.stat{text-align:center}.stat-number{display:block;font-size:2.5rem;font-weight:700;color:#FFD700;margin-bottom:0.5rem}.stat-label{font-size:0.9rem;opacity:0.9}.product-filter{background:white;padding:2rem 0;border-bottom:1px solid #E2E8F0}.filter-tabs{display:flex;justify-content:center;gap:1rem;flex-wrap:wrap}.filter-btn{padding:0.75rem 1.5rem;border:2px solid #E2E8F0;background:white;color:#64748B;border-radius:25px;font-weight:500;cursor:pointer;transition:all 0.3s ease}.filter-btn.active,.filter-btn:hover{border-color:#2563EB;background:#2563EB;color:white}.products-section{padding:5rem 0;background:white}.product-category{margin-bottom:5rem}.category-title{font-size:2.5rem;font-weight:700;color:#1E293B;margin-bottom:1rem;text-align:center;position:relative}.category-title::after{content:'';position:absolute;bottom:-10px;left:50%;transform:translateX(-50%);width:80px;height:3px;background:linear-gradient(135deg,#2563EB 0%,#1D4ED8 100%);border-radius:2px}.category-description{text-align:center;color:#64748B;font-size:1.1rem;margin-bottom:3rem;max-width:600px;margin-left:auto;margin-right:auto}.products-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(350px,1fr));gap:2rem}.product-card{position:relative;background:white;border-radius:16px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,0.08);transition:all 0.3s ease;border:1px solid #F1F5F9}.product-card:hover{transform:translateY(-4px);box-shadow:0 12px 30px rgba(0,0,0,0.15);border-color:#2563EB}.product-badge{position:absolute;top:1rem;left:1rem;padding:0.5rem 1rem;border-radius:20px;font-size:0.75rem;font-weight:600;z-index:5;text-transform:uppercase;letter-spacing:0.5px}.product-badge:not(.eco):not(.popular):not(.coastal):not(.quality){background:#FEF3C7;color:#92400E}.product-badge.eco{background:#D1FAE5;color:#065F46}.product-badge.popular{background:#DBEAFE;color:#1E40AF}.product-badge.coastal{background:#E0F2FE;color:#0C4A6E}.product-badge.quality{background:#F3E8FF;color:#6B21A8}.product-image{position:relative;height:250px;overflow:hidden;
    /* Added a white background for a clean look with non-standard image sizes */
    background-color: #fff;
  }.product-image img{width:100%;height:100%;
    /* This is the key change: from 'cover' to 'contain' */
    object-fit: contain;
    transition:transform .3s ease}.product-card:hover .product-image img{transform:scale(1.05)}.product-overlay{position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity 0.3s ease;z-index:5}.product-card:hover .product-overlay{opacity:1}.quick-view-btn{background:white;color:#2563EB;border:none;padding:0.75rem 1.5rem;border-radius:25px;font-weight:600;cursor:pointer;transition:all 0.3s ease;z-index:10;position:relative;box-shadow:0 4px 8px rgba(0,0,0,0.2)}.quick-view-btn:hover{background:#2563EB;color:white;transform:translateY(-2px);box-shadow:0 6px 12px rgba(0,0,0,0.25)}.product-info{padding:2rem;display:flex;flex-direction:column;flex-grow:1}.product-info h3{font-size:1.75rem;font-weight:700;color:#1E293B;margin-bottom:1rem}.product-description{font-size:1rem;color:#64748B;margin-bottom:1.5rem;line-height:1.6;flex-grow:1}.product-specs{background:#F8FAFC;padding:1rem;border-radius:8px;margin-bottom:1.5rem;box-shadow:inset 0 2px 4px rgba(0,0,0,0.05);border:1px solid #E2E8F0}.spec{display:flex;justify-content:space-between;padding:0.5rem 0;border-bottom:1px dashed #E2E8F0}.spec:last-child{border-bottom:none}.spec-label{color:#64748B;font-weight:500;font-size:0.9rem}.spec-value{color:#1E293B;font-weight:600;font-size:0.9rem}.product-features{display:flex;gap:0.5rem;margin-bottom:1.5rem;flex-wrap:wrap}.feature{background:#eff6ff;color:#1e40af;padding:0.375rem 0.75rem;border-radius:20px;font-size:0.875rem;font-weight:500}.product-actions{margin-top:auto}.product-price{font-size:1.125rem;font-weight:600;color:#059669;margin-bottom:1rem}.action-buttons{display:flex;gap:0.75rem}.btn{padding:0.75rem 1.5rem;border-radius:8px;font-weight:600;cursor:pointer;transition:all 0.3s ease;border:none;display:flex;align-items:center;gap:0.5rem;flex:1;justify-content:center;text-decoration:none}.btn-primary{background:linear-gradient(135deg,#1e40af 0%,#3b82f6 100%);color:white}.btn-primary:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(59,130,246,0.3)}.btn-success{background:#10b981;color:white}.btn-success:hover{background:#059669;transform:translateY(-2px);box-shadow:0 8px 20px rgba(16,185,129,0.3)}.btn-sm{padding:0.5rem 1rem;font-size:0.875rem}.carousel-container{position:relative;padding:0;margin-bottom:3rem;width:100%;max-width:1200px;margin-left:auto;margin-right:auto;text-align:center}.carousel-control{width:48px;height:48px;border-radius:50%;background:#F1F5F9;border:none;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.3s ease;color:#64748B;box-shadow:0 2px 8px rgba(0,0,0,0.1);position:absolute;top:50%;transform:translateY(-50%);z-index:10}.carousel-control.prev{left:-20px}.carousel-control.next{right:-20px}.carousel-control:hover{background:#E2E8F0;color:#1E293B;transform:translateY(-50%) scale(1.05)}.carousel-control:disabled{opacity:0.5;cursor:not-allowed}.carousel-dots-container{position:absolute;bottom:-2.5rem;left:0;right:0;display:flex;justify-content:center}.carousel-dots{display:flex;gap:0.75rem;justify-content:center;align-items:center}.carousel-dot{width:12px;height:12px;border-radius:50%;background:#E2E8F0;border:none;padding:0;cursor:pointer;transition:all 0.3s ease;box-shadow:0 1px 3px rgba(0,0,0,0.1)}.carousel-dot.active{background:#2563EB;transform:scale(1.2)}@media (max-width: 768px){.hero-stats{gap:2rem}.stat-number{font-size:2rem}.hero-content h1{font-size:2rem}.category-title{font-size:2rem}.products-grid{grid-template-columns:1fr}.product-info{padding:1.5rem}.action-buttons{flex-direction:row;gap:0.5rem}.btn{width:auto;padding:0.75rem 1rem}.cta-content{padding:1.5rem;margin:0 1rem}.cta-content h2{font-size:1.5rem}.cta-content p{font-size:0.95rem;margin-bottom:1.5rem}.cta-buttons{flex-direction:column;align-items:center;gap:0.75rem}.cta-buttons .btn{width:100%;max-width:280px;min-width:auto}.modal{width:95%;margin:1rem}.modal-content{padding:1.5rem}}.products-carousel{display:flex;overflow-x:auto;scroll-behavior:smooth;gap:1.5rem;padding:1rem 0;-ms-overflow-style:none;scrollbar-width:none;scroll-snap-type:x mandatory}.products-carousel::-webkit-scrollbar{display:none}.products-carousel .product-card{flex:0 0 auto;width:100%;max-width:400px;scroll-snap-align:start;margin:0}@media (min-width: 640px){.products-carousel .product-card{width:calc(50% - 0.75rem);max-width:none}}@media (min-width: 768px){.products-carousel .product-card{width:calc(50% - 0.75rem)}}@media (min-width: 1024px){.products-carousel .product-card{width:calc(33.333% - 1rem)}}.product-card{display:flex;flex-direction:column;height:100%}.product-features{margin-top:auto;margin-bottom:1.5rem}@media (max-width: 480px){.action-buttons{flex-direction:column;gap:0.75rem}.action-buttons .btn{width:100%}.carousel-control{width:40px;height:40px}}.modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:1000;opacity:0;visibility:hidden;transition:opacity 0.3s,visibility 0.3s}.modal-overlay.active{opacity:1;visibility:visible}.modal{background:white;border-radius:16px;width:90%;max-width:800px;max-height:90vh;overflow:auto;position:relative;box-shadow:0 10px 25px rgba(0,0,0,0.3)}.modal-close{position:absolute;top:1rem;right:1rem;background:#F1F5F9;border:none;width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;color:#64748B;transition:all 0.3s ease;z-index:10}.modal-close:hover{background:#E2E8F0;color:#1E293B}.modal-content{padding:2rem}.carousel-dot.active{background:#2563EB;transform:scale(1.2)}.carousel-control:disabled{opacity:0.5;cursor:not-allowed}.cta-section{background:linear-gradient(135deg,#F8FAFC 0%,#F1F5F9 100%);padding:3rem 0;margin-top:2rem}.cta-content{background:white;border-radius:12px;padding:2rem;box-shadow:0 8px 20px rgba(0,0,0,0.08);text-align:center;max-width:700px;margin:0 auto;position:relative;border:1px solid #E2E8F0;overflow:hidden}.cta-content::before{content:'';position:absolute;top:0;left:0;width:100%;height:4px;background:linear-gradient(90deg,#2563EB,#1D4ED8)}.cta-content h2{font-size:1.75rem;font-weight:700;color:#1E293B;margin-bottom:0.75rem;line-height:1.2}.cta-content p{font-size:1rem;color:#64748B;margin-bottom:1.75rem;max-width:450px;margin-left:auto;margin-right:auto;line-height:1.5}.cta-buttons{display:flex;justify-content:center;gap:1rem;flex-wrap:wrap}.cta-buttons .btn{padding:0.75rem 1.25rem;min-width:140px;font-size:0.9rem;font-weight:600;display:inline-flex;align-items:center;justify-content:center;gap:0.5rem;border-radius:6px;transition:all 0.3s ease;text-decoration:none}.cta-buttons .btn-primary{background:#2563EB;color:white;box-shadow:0 3px 5px rgba(37,99,235,0.15)}.cta-buttons .btn-primary:hover{background:#1D4ED8;transform:translateY(-1px);box-shadow:0 5px 8px rgba(37,99,235,0.2)}.cta-buttons .btn-secondary{background:#F8FAFC;color:#1E293B;box-shadow:0 3px 5px rgba(0,0,0,0.05);border:1px solid #E2E8F0}.cta-buttons .btn-secondary:hover{background:#E2E8F0;transform:translateY(-1px);box-shadow:0 5px 8px rgba(0,0,0,0.06)}.cta-buttons .btn-success{background:#10B981;color:white;box-shadow:0 3px 5px rgba(16,185,129,0.15)}.cta-buttons .btn-success:hover{background:#059669;transform:translateY(-1px);box-shadow:0 5px 8px rgba(16,185,129,0.2)}@media (max-width: 768px){.cta-section{padding:2rem 0}.cta-content{padding:1.5rem;margin:0 1rem}.cta-content h2{font-size:1.5rem}.cta-content p{font-size:0.95rem;margin-bottom:1.5rem}.cta-buttons{flex-direction:column;align-items:center;gap:0.75rem}.cta-buttons .btn{width:100%;max-width:280px;min-width:auto}}
</style>

<script define:vars={{ productData: productDataForClient, brandNames: brandNamesForClient }}>
  document.addEventListener('DOMContentLoaded', () => {
    // --- Standard page logic (counters, filters, modal) ---
    const statNumbers = document.querySelectorAll('.stat-number');
    const animateCounter = (element) => {
      const targetText = element.dataset.targetValue;
      const targetNumber = parseInt(targetText, 10);
      const suffix = targetText.replace(targetNumber, '') || '';
      const duration = 1500;
      let startTimestamp = null;
      const step = (timestamp) => {
        if (!startTimestamp) startTimestamp = timestamp;
        const progress = Math.min((timestamp - startTimestamp) / duration, 1);
        const currentValue = Math.floor(progress * targetNumber);
        element.textContent = currentValue + suffix;
        if (progress < 1) {
          window.requestAnimationFrame(step);
        }
      };
      window.requestAnimationFrame(step);
    };
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          if (!entry.target.dataset.targetValue) {
            entry.target.dataset.targetValue = entry.target.textContent;
          }
          animateCounter(entry.target);
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.5 });
    statNumbers.forEach(number => {
      observer.observe(number);
    });

    const filterBtns = document.querySelectorAll('.filter-btn');
    const productCategories = document.querySelectorAll('.product-category');
    filterBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        filterBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const filter = btn.dataset.filter;
        productCategories.forEach(category => {
          if (filter === 'all') {
            category.style.display = 'block';
          } else {
            const categoryType = category.dataset.category;
            console.log('Filter:', filter, 'Category Type:', categoryType); // Debug log
            
            // Fix: Better category matching logic
            let shouldShow = false;
            if (filter === 'building-materials') {
              // Show if category contains 'building' or is undefined (fallback)
              shouldShow = !categoryType || categoryType === 'building-materials' || categoryType.includes('building');
            } else {
              shouldShow = categoryType === filter;
            }
            
            category.style.display = shouldShow ? 'block' : 'none';
          }
        });
      });
    });

    const modal = document.getElementById('modal-overlay');
    const modalContent = document.getElementById('modal-content');
    const modalClose = document.getElementById('modal-close');
    const quickViewBtns = document.querySelectorAll('.quick-view-btn');
    
    quickViewBtns.forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        const productId = btn.dataset.product;
        // Uses `productData` which is the correct client-side variable
        const product = productData[productId];
        if (product) {
          modalContent.innerHTML = `
            <div class="modal-product">
              <div class="modal-image"><img src="${product.image}" alt="${product.name}" style="width: 100%; height: 300px; object-fit: contain; border-radius: 8px;"></div>
              <div class="modal-info">
                <h2 style="font-size: 1.75rem; font-weight: 600; color: #1E293B; margin: 1.5rem 0;">${product.name}</h2>
                <p style="color: #64748B; line-height: 1.6; margin-bottom: 2rem;">${product.description}</p>
                <h3 style="font-size: 1.25rem; font-weight: 600; color: #1E293B; margin-bottom: 1rem;">Specifications</h3>
                <div style="background: #F8FAFC; padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem; box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05); border: 1px solid #E2E8F0;">
                  ${Object.entries(product.specs).map(([key, value]) => `<div style="display: flex; justify-content: space-between; margin-bottom: 0.75rem; padding-bottom: 0.75rem; border-bottom: 1px dashed #E2E8F0;"><span style="color: #64748B; font-weight: 500;">${key}:</span><span style="color: #1E293B; font-weight: 600;">${value}</span></div>`).join('')}
                </div>
                <h3 style="font-size: 1.25rem; font-weight: 600; color: #1E293B; margin-bottom: 1rem;">Key Features</h3>
                <div style="display: flex; gap: 0.75rem; flex-wrap: wrap; margin-bottom: 2rem; justify-content: center;">
                  ${product.features.map(feature => `<span style="background: #EFF6FF; color: #1D4ED8; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.875rem; font-weight: 500;">${feature}</span>`).join('')}
                </div>
                <div style="display: flex; gap: 1rem; margin-top: 2rem; justify-content: center;">
                  <a href="/contact" class="btn btn-primary" style="flex: 1.5; min-width: 120px; display: flex; align-items: center; justify-content: center;">Get Quote</a>
                  <a href="https://wa.me/919765664489?text=I'm interested in ${encodeURIComponent(product.name)}" class="btn btn-success" style="flex: 1; min-width: 120px; display: flex; align-items: center; justify-content: center; gap: 8px;">
                    <svg viewBox="0 0 24 24" width="20" height="20"><path fill="currentColor" d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.106"></path></svg>
                    WhatsApp
                  </a>
                </div>
              </div>
            </div>`;
          modal.classList.add('active');
          document.body.style.overflow = 'hidden';
        }
      });
    });
    document.querySelectorAll('.product-card').forEach(card => {
      card.addEventListener('click', (e) => {
        if (e.target.closest('.btn') || e.target.closest('a') || e.target.closest('.quick-view-btn')) return;
        card.querySelector('.quick-view-btn')?.click();
      });
    });
    function closeModal() {
      modal.classList.remove('active');
      document.body.style.overflow = '';
    }
    modalClose?.addEventListener('click', closeModal);
    modal?.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeModal(); });

    // --- SMOOTH CAROUSEL LOGIC ---
    function initCarousel(carouselId, prevBtnId, nextBtnId, dotsId) {
        const carousel = document.getElementById(carouselId);
        const prevBtn = document.getElementById(prevBtnId);
        const nextBtn = document.getElementById(nextBtnId);
        const dotsContainer = document.getElementById(dotsId);

        if (!carousel || !prevBtn || !nextBtn || !dotsContainer) return;

        const cards = carousel.querySelectorAll('.product-card');
        if (cards.length === 0) {
            prevBtn.style.display = 'none';
            nextBtn.style.display = 'none';
            dotsContainer.style.display = 'none';
            return;
        }

        const cardCount = cards.length;
        let scrollTimeout;

        // This function updates button states and active dots based on scroll position
        const updateCarouselState = () => {
            // Disable/enable prev/next buttons
            const isAtStart = carousel.scrollLeft < 10;
            const isAtEnd = carousel.scrollLeft + carousel.clientWidth >= carousel.scrollWidth - 10;
            prevBtn.disabled = isAtStart;
            nextBtn.disabled = isAtEnd;

            // Update active dot
            const cardWidth = cards[0].offsetWidth;
            const gap = parseInt(window.getComputedStyle(carousel).gap) || 24; // Default to 24px (1.5rem) if gap not found
            const cardWidthWithGap = cardWidth + gap;
            const currentIndex = Math.round(carousel.scrollLeft / cardWidthWithGap);
            const dots = dotsContainer.querySelectorAll('.carousel-dot');
            dots.forEach((dot, index) => {
                dot.classList.toggle('active', index === currentIndex);
            });
        };
        
        // This function creates the navigation dots
        const createDots = () => {
            dotsContainer.innerHTML = '';
            for (let i = 0; i < cardCount; i++) {
                const dot = document.createElement('button');
                dot.classList.add('carousel-dot');
                dot.setAttribute('aria-label', `Go to slide ${i + 1}`);
                dot.addEventListener('click', () => {
                    const cardWidth = cards[0].offsetWidth;
                    const gap = parseInt(window.getComputedStyle(carousel).gap) || 24;
                    const scrollToPosition = i * (cardWidth + gap);
                    carousel.scrollTo({ left: scrollToPosition, behavior: 'smooth' });
                });
                dotsContainer.appendChild(dot);
            }
        };

        // THE FIX: Scroll by the carousel's visible width for a smooth "page" effect
        prevBtn.addEventListener('click', () => {
            carousel.scrollBy({ left: -carousel.clientWidth, behavior: 'smooth' });
        });

        nextBtn.addEventListener('click', () => {
            carousel.scrollBy({ left: carousel.clientWidth, behavior: 'smooth' });
        });

        // Update the state after any scroll action (button click, drag, dot click)
        carousel.addEventListener('scroll', () => {
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(updateCarouselState, 150); // Debounce to run after scroll finishes
        });
        
        // Initial setup
        createDots();
        // Use a timeout to ensure the browser has calculated the layout
        setTimeout(() => {
            // Hide controls if the content isn't wide enough to scroll
            if (carousel.scrollWidth <= carousel.clientWidth) {
                prevBtn.style.display = 'none';
                nextBtn.style.display = 'none';
                dotsContainer.style.display = 'none';
            } else {
                updateCarouselState(); // Set initial button/dot state
            }
        }, 100);
    }
    
    // Initialize all carousels on the page
    setTimeout(() => {
        brandNames.forEach(brandName => {
            const brandId = brandName.toLowerCase().replace(/ & /g, '-').replace(/ /g, '-');
            initCarousel(`${brandId}-carousel`, `${brandId}-prev`, `${brandId}-next`, `${brandId}-dots`);
        });
    }, 100);
  });
</script>